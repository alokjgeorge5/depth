<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Depth AI Council</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -1000px 0;
      }

      100% {
        background-position: 1000px 0;
      }
    }

    .animate-fade-in {
      animation: fadeIn 0.3s ease-out;
    }

    .animate-pulse-soft {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    .skeleton {
      background: linear-gradient(90deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.1) 50%,
          rgba(255, 255, 255, 0) 100%);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite;
    }

    .dark .skeleton {
      background: linear-gradient(90deg,
          rgba(0, 0, 0, 0) 0%,
          rgba(255, 255, 255, 0.05) 50%,
          rgba(0, 0, 0, 0) 100%);
    }

    /* Scrollbar styling */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(156, 163, 175, 0.3);
      border-radius: 3px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(156, 163, 175, 0.5);
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      :root {
        color-scheme: dark;
      }
    }

    /* Focus visible for accessibility */
    *:focus-visible {
      outline: 2px solid #3B82F6;
      outline-offset: 2px;
    }

    /* Agent color variables */
    :root {
      --color-maya: #10B981;
      --color-alex: #3B82F6;
      --color-turing: #F59E0B;
      --color-marcus: #EF4444;
    }
  </style>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            gray: {
              50: '#f9f9f9',
              100: '#ececec',
              200: '#e3e3e3',
              300: '#cdcdcd',
              400: '#b4b4b4',
              500: '#9b9b9b',
              600: '#676767',
              700: '#4e4e4e',
              800: '#333333',
              850: '#262626',
              900: '#171717',
              950: '#0d0d0d'
            }
          }
        }
      }
    }
  </script>
</head>

<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors">

  <!-- Main Container -->
  <div id="app" class="h-screen flex flex-col">

    <!-- Header -->
    <header class="border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm">
      <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="size-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
            <svg class="size-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z" />
            </svg>
          </div>
          <h1 class="text-lg font-medium">Depth AI Council</h1>
        </div>

        <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
          aria-label="Toggle theme">
          <svg class="size-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
          <svg class="size-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
          </svg>
        </button>
      </div>
    </header>

    <!-- Messages Container -->
    <main id="messages-container" class="flex-1 overflow-y-auto custom-scrollbar">
      <div class="max-w-6xl mx-auto px-4 py-8">

        <!-- Placeholder when no messages -->
        <div id="placeholder" class="flex flex-col items-center justify-center min-h-[60vh]">
          <div class="text-center max-w-2xl">
            <div
              class="size-16 mx-auto mb-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center">
              <svg class="size-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z" />
              </svg>
            </div>
            <h2 class="text-2xl font-medium mb-3">Ask the Council</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-8">
              Four expert perspectives on your strategic question. MAYA brings customer insight, ALEX provides CEO
              vision, TURING offers technical depth, and MARCUS assesses risks.
            </p>

            <!-- Agent Pills -->
            <div class="flex flex-wrap gap-2 justify-center">
              <div
                class="px-3 py-1.5 rounded-full text-xs font-medium bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border border-green-200 dark:border-green-800">
                <span class="inline-block size-2 rounded-full bg-green-500 mr-1.5"></span>
                MAYA • Customer
              </div>
              <div
                class="px-3 py-1.5 rounded-full text-xs font-medium bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800">
                <span class="inline-block size-2 rounded-full bg-blue-500 mr-1.5"></span>
                ALEX • CEO
              </div>
              <div
                class="px-3 py-1.5 rounded-full text-xs font-medium bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-300 border border-amber-200 dark:border-amber-800">
                <span class="inline-block size-2 rounded-full bg-amber-500 mr-1.5"></span>
                TURING • Engineering
              </div>
              <div
                class="px-3 py-1.5 rounded-full text-xs font-medium bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-800">
                <span class="inline-block size-2 rounded-full bg-red-500 mr-1.5"></span>
                MARCUS • Risk
              </div>
            </div>
          </div>
        </div>

        <!-- Messages will be inserted here -->
        <div id="messages"></div>

      </div>
    </main>

    <!-- Input Area -->
    <footer class="border-t border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900">
      <div class="max-w-6xl mx-auto px-4 py-4">
        <form id="chat-form" class="relative">

          <!-- Error Display -->
          <div id="error-message"
            class="hidden mb-4 p-3 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 text-sm animate-fade-in">
            <div class="flex items-start gap-2">
              <svg class="size-5 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span id="error-text"></span>
            </div>
          </div>

          <!-- Input Container -->
          <div
            class="shadow-lg rounded-3xl border border-gray-100/30 dark:border-gray-850/30 bg-white/5 dark:bg-gray-500/5 backdrop-blur-sm transition-colors hover:border-gray-200 dark:hover:border-gray-800 focus-within:border-gray-300 dark:focus-within:border-gray-700">
            <div class="px-4 py-3">
              <textarea id="question-input" rows="3" placeholder="Ask the council a strategic question..."
                class="w-full bg-transparent resize-none outline-none text-base placeholder:text-gray-400 dark:placeholder:text-gray-600"
                aria-label="Question input"></textarea>
            </div>

            <!-- Action Bar -->
            <div class="flex items-center justify-between px-4 pb-3 pt-1">
              <div class="text-xs text-gray-500 dark:text-gray-400">
                <span id="char-count">0</span> characters
              </div>

              <div class="flex items-center gap-2">
                <button type="button" id="clear-btn"
                  class="hidden px-3 py-1.5 rounded-full text-xs font-medium bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-300 transition-colors"
                  aria-label="Clear input">
                  Clear
                </button>

                <button type="submit" id="submit-btn" disabled
                  class="px-4 py-1.5 rounded-full text-sm font-medium bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:pointer-events-none flex items-center gap-2"
                  aria-label="Submit question">
                  <span>Ask Council</span>
                  <svg class="size-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13 7l5 5m0 0l-5 5m5-5H6" />
                  </svg>
                </button>
              </div>
            </div>
          </div>

        </form>
      </div>
    </footer>

  </div>

  <script>
    // State management
    const state = {
      conversationId: null,
      isLoading: false,
      messages: []
    };

    // Agent configuration
    const AGENTS = {
      MAYA: { name: 'MAYA', title: 'Customer', color: '#10B981' },
      ALEX: { name: 'ALEX', title: 'CEO', color: '#3B82F6' },
      TURING: { name: 'TURING', title: 'Engineering', color: '#F59E0B' },
      MARCUS: { name: 'MARCUS', title: 'Risk', color: '#EF4444' }
    };

    // DOM elements
    const elements = {
      form: document.getElementById('chat-form'),
      input: document.getElementById('question-input'),
      submitBtn: document.getElementById('submit-btn'),
      clearBtn: document.getElementById('clear-btn'),
      charCount: document.getElementById('char-count'),
      messages: document.getElementById('messages'),
      placeholder: document.getElementById('placeholder'),
      messagesContainer: document.getElementById('messages-container'),
      errorMessage: document.getElementById('error-message'),
      errorText: document.getElementById('error-text'),
      themeToggle: document.getElementById('theme-toggle')
    };

    // Theme management
    function initTheme() {
      const isDark = localStorage.getItem('theme') === 'dark' ||
        (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
      document.documentElement.classList.toggle('dark', isDark);
    }

    elements.themeToggle.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // Initialize theme
    initTheme();

    // Input handling
    elements.input.addEventListener('input', (e) => {
      const value = e.target.value.trim();
      elements.charCount.textContent = value.length;
      elements.submitBtn.disabled = value.length === 0 || state.isLoading;
      elements.clearBtn.classList.toggle('hidden', value.length === 0);
    });

    elements.clearBtn.addEventListener('click', () => {
      elements.input.value = '';
      elements.charCount.textContent = '0';
      elements.submitBtn.disabled = true;
      elements.clearBtn.classList.add('hidden');
      elements.input.focus();
    });

    // Auto-resize textarea
    elements.input.addEventListener('input', function () {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 200) + 'px';
    });

    // Error handling
    function showError(message) {
      elements.errorText.textContent = message;
      elements.errorMessage.classList.remove('hidden');
      setTimeout(() => {
        elements.errorMessage.classList.add('hidden');
      }, 5000);
    }

    function hideError() {
      elements.errorMessage.classList.add('hidden');
    }

    // UI helpers
    function scrollToBottom(smooth = true) {
      elements.messagesContainer.scrollTo({
        top: elements.messagesContainer.scrollHeight,
        behavior: smooth ? 'smooth' : 'auto'
      });
    }

    function getConfidenceColor(score) {
      if (score >= 80) return { bg: 'bg-green-50 dark:bg-green-900/20', text: 'text-green-700 dark:text-green-300', border: 'border-green-200 dark:border-green-800' };
      if (score >= 60) return { bg: 'bg-amber-50 dark:bg-amber-900/20', text: 'text-amber-700 dark:text-amber-300', border: 'border-amber-200 dark:border-amber-800' };
      return { bg: 'bg-red-50 dark:bg-red-900/20', text: 'text-red-700 dark:text-red-300', border: 'border-red-200 dark:border-red-800' };
    }

    // Message rendering
    function createUserMessage(question) {
      return `
        <div class="flex flex-col gap-4 mb-8 animate-fade-in">
          <div class="flex items-start gap-3">
            <div class="size-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center shrink-0 mt-1">
              <svg class="size-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <div class="flex-1">
              <div class="text-sm font-medium mb-1">You</div>
              <div class="text-sm leading-relaxed">${escapeHtml(question)}</div>
            </div>
          </div>
        </div>
      `;
    }

    function createLoadingState() {
      return `
        <div class="space-y-6 mb-8 animate-fade-in" id="loading-state">
          ${Object.values(AGENTS).map(agent => `
            <div class="flex items-start gap-3">
              <div class="size-8 rounded-full flex items-center justify-center shrink-0 mt-1" style="background-color: ${agent.color}20; color: ${agent.color};">
                <span class="text-sm font-medium">${agent.name[0]}</span>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-sm font-medium">${agent.name}</span>
                  <span class="text-xs text-gray-500 dark:text-gray-400">${agent.title}</span>
                </div>
                <div class="space-y-2">
                  <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded skeleton" style="width: 90%"></div>
                  <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded skeleton" style="width: 75%"></div>
                  <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded skeleton" style="width: 85%"></div>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function createAgentResponse(agent, response) {
      const agentConfig = AGENTS[agent.persona];
      const colors = getConfidenceColor(response.confidence);

      return `
        <div class="flex items-start gap-3 group animate-fade-in">
          <div class="size-8 rounded-full flex items-center justify-center shrink-0 mt-1" style="background-color: ${agentConfig.color}20; color: ${agentConfig.color};">
            <span class="text-sm font-medium">${agentConfig.name[0]}</span>
          </div>
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-sm font-medium">${agentConfig.name}</span>
              <span class="text-xs text-gray-500 dark:text-gray-400">${agentConfig.title}</span>
              <div class="ml-auto px-2 py-0.5 rounded-full text-xs font-medium ${colors.bg} ${colors.text} border ${colors.border}">
                ${response.confidence}%
              </div>
            </div>
            ${response.title ? `<div class="text-sm font-medium mb-2">${escapeHtml(response.title)}</div>` : ''}
            <div class="text-sm leading-relaxed text-gray-700 dark:text-gray-300">
              ${escapeHtml(response.content)}
            </div>
          </div>
        </div>
      `;
    }

    function createResponsesContainer(responses) {
      return `
        <div class="space-y-6 mb-8" id="responses">
          ${responses.map(r => createAgentResponse(r, r)).join('')}
        </div>
      `;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // API call
    async function submitQuestion(question) {
      hideError();
      state.isLoading = true;
      elements.submitBtn.disabled = true;
      elements.input.disabled = true;
      elements.placeholder.classList.add('hidden');

      // Add user message
      elements.messages.insertAdjacentHTML('beforeend', createUserMessage(question));

      // Add loading state
      elements.messages.insertAdjacentHTML('beforeend', createLoadingState());
      scrollToBottom();

      try {
        const response = await fetch('/api/getResponses', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            question: question,
            conversation_id: state.conversationId
          })
        });

        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }

        const data = await response.json();

        // Update conversation ID
        if (data.conversation_id) {
          state.conversationId = data.conversation_id;
        }

        // Remove loading state
        document.getElementById('loading-state')?.remove();

        // Add responses
        if (data.responses && data.responses.length > 0) {
          elements.messages.insertAdjacentHTML('beforeend', createResponsesContainer(data.responses));
          state.messages.push({
            question,
            responses: data.responses
          });
        } else {
          throw new Error('No responses received from council');
        }

        scrollToBottom();

      } catch (error) {
        console.error('Error:', error);
        document.getElementById('loading-state')?.remove();
        showError(error.message || 'Failed to get responses. Please try again.');
      } finally {
        state.isLoading = false;
        elements.input.disabled = false;
        elements.input.value = '';
        elements.charCount.textContent = '0';
        elements.submitBtn.disabled = true;
        elements.clearBtn.classList.add('hidden');
        elements.input.style.height = 'auto';
        elements.input.focus();
      }
    }

    // Form submission
    elements.form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const question = elements.input.value.trim();
      if (question && !state.isLoading) {
        await submitQuestion(question);
      }
    });

    // Keyboard shortcut (Cmd/Ctrl + Enter)
    elements.input.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
        e.preventDefault();
        if (!elements.submitBtn.disabled) {
          elements.form.dispatchEvent(new Event('submit'));
        }
      }
    });

    // Focus input on load
    elements.input.focus();

  </script>
</body>

</html>